---
title: "QoS 和 QoE"
subtitle: ""
layout: post
author: "L Hondong"
header-img: "img/post-bg-27.jpg"
mathjax: true
tags:
  - QoE 
  - QoS
  - 视频质量
---

# QoS 和 QoE

**QoS**（Quality of Service，服务质量）和 **QoE**（Quality of Experience，体验质量）虽然相关，但却是两个独立的概念，并以完全不同的方式进行衡量和使用。

## 什么是 QoS 和 QoE？

根据 ITU 的描述，QoS 是指 “电信服务的全部特性，这些特性与该服务是否能够满足用户明确和隐含需求的能力有关”。在这个定义下，QoS 衡量视频传输基础设施的性能，包括第三方或者内部 CDN、跟踪数据（如总体吞吐量、延迟、错误率以及缓存命中率）。

相比之下，ITU 对于 QoE 的定义是 “终端用户主观感知到的应用程序或者服务的整体可接受性。它包括完整的端到端系统效应（客户、终端、网络、服务基础设施等），有可能受到用户期望和环境影响”。所以 QoE 直接衡量用户体验，包括播放成功、起播时间、重新缓冲以及视觉质量等因素（编码和解码时）。

图中显示了 QoS 和 QoE 是如何相互关联的，左图是通过编码和打包准备内容，接着文件被移交给传输基础设施进行分发，此处由 QoS 来衡量。一旦在观看位置被接收，视频便被解码，并在播放器中观看。QoE 包括了完整的端到端体验，而 QoS 衡量的是中间的分发部分。

<div align=center><img src="https://lhondong-pic.oss-cn-shenzhen.aliyuncs.com/img/assets/QoS_QoE-2022-05-27-13-38-53.png" alt="QoS_QoE-2022-05-27-13-38-53" style="zoom:50%;" /></div>

很明显，网络性能对于好的 QoE 十分关键。但其他如视频源质量、编码质量、打包完整性和视频观看环境等因素也同样重要。在手机上创作看起来很棒的内容是一回事，但是能生产和交付显示在你客厅中 85 寸 LED 电视上的内容却是另外一回事。

你可能拥有很棒的 QoS 但很差的 QoE，比如，当源材料质量很粗糙或者播放器由于错误逻辑没有切换到最高质量的 ABR 视频流。你还可能拥有高质量的 QoE 和低质量的 QoS，比如，网速足以准时传输视频，但是缓存性能很差，这就增加了带宽和分发成本。所以想要全面了解情况，你就必须一起衡量 QoS 和 QoE。

QoS 是基建，低 QoS 大概率会导致低 QoE，这也是为什么在过去的几十年里，人们一直用 QoS 来代表 QoE。实际中，一种低 QoS 高 QoE 的情况是：网络丢包率比较高，但视频的编解码段做了很好的误差纠错和隐藏，比如 WebRTC 的情况，QoE 还是可以达到用户满意的效果的。

## 如何衡量 QoS？

一些系统为了监测便在系统之间的网络上安装了探测器。这些探测器可以是硬件设备或者软件程序，被安装在遍布互联网的服务中心里，用来监测从某个或者多个源站到某个目的地或多个目的地这一过程中的流量。

所以如果想要监测内容准备前端和核心网络之间的性能，就要在核心网络安装探测器。如果想要监测核心网络和边缘网络之间的流媒体服务，就要在边缘侧安装探测器。可以通过这些探测器确定传输问题的位置，从而确定问题的源头。

其他系统通过在自己的播放器安装软件跟踪 QoS，对于 QoE 来说，这是最常见的部署方案。

对于应该跟踪哪些 QoS 指标，产品和服务提供商不同，指标也不一样。但是像吞吐量、码率、延迟、抖动和丢包等指标都会被各厂商跟踪和对比。

## 如何衡量 QoE？

QoE 通常通过播放器中的插件测量，这些插件将性能数据报告给中央数据库进行分析和呈现。不同的服务提供商使用不同的方法提取数据和跟踪数据。

两个权威组织已经给出了关键数据点。流媒体视频联盟（Streaming Video Alliance）所给出的关键指标是：视频起播时间、缓冲比率、平均媒体码率和视频启动失败（表 1）。

| 指标 | 描述  |
| --- | --- |
| 视频起播时间 | 从播放事件开始直到网络传输的视频的第一帧被渲染所用时间。注意：预加载的 Splash 视频的显示与此指标无关。 |
| 重新缓冲比率  | 观众体验重新缓冲的时间比例（即当视频因为缓冲区下溢而非用户的直接干预（快进快退或者暂停视频）而停止播放时）。`<br>`比率计算：**总体重新缓冲时间除以总体播放时间与总体重新缓冲时间之和**。`<br>`在特定设备上，不太可能从测量到的重新缓冲时间中排除快进快退时间。为了使其在所有设备上具备可比性，可以计算一个单独的指标，其中包括每台设备的快进快退和暂停时间。还可以对每台设备进行测量以保持这些指标的可比性。 |
| 平均媒体码率 (每秒多少比特) | 平均码率就是每个播放 session 所下载视频块的综合平均比特率，一般以 Mbps 或者 Kbps 为单位。 |
| 视频启动失败（是或否） | 当第一个视频块在播放事件开后的截止时间（10 秒）内未完全交付时。 |

美国消费技术协会（Consumer Technology Association）推荐监测播放失败、起播时间、播放暂停、码率、播放器故障和其他指标，包括广告插入和许多其他播放器和视频播放数据点，如播放器宽度、视频分辨率。任何想要从跟踪数据中获取数据点的人都应该查看这两个文档。

## QoS 和 QoE 的系统功能

当分值下降到低于一定水平，就会发出警告，技术人员通过此功能可以跟踪所有可用频道，并在性能下降到低于一定阈值时迅速识别。通常情况下，这些警告会发送电子邮件或者文本通知，所以你不必时时刻刻监控视频以发现问题。

一旦发出警告，服务提供商就能在用户出现糟糕体验前，诊断和解决问题（通过使用不同的 CDN）。很多 QoS 和 QoE 系统能够根据性能数据自动转换 CDN 或者支持手动转换。

QoS 和 QoE 系统提供必要的数据以便在不同级别上对比各类产品和服务提供商。比如，如果使用了几个不同的 CDN，可以跟踪关键性能指标的数值，比如每个 CDN 所达到的吞吐量、平均传输码率等；可以使用数据对比不同厂商的价格/性能，识别潜在问题，和（或）控制每个服务提供商应该分配哪些客户。

很多大型 QoE 和 QoS 服务提供商还可以提供特定行业的数据，所以可以将自己公司的性能与其他处在同一地理区域并分发同样内容的公司进行对比。当你能够知道竞争对手的优势和劣势，并以此提升自己的服务时，这些数据就显得尤为宝贵。

正如在文章开头所说，无论通过哪种方式使视频流媒体获得收益，最有效的方式就是良好的观看体验。而确保观看体验的唯一方法就是跟踪和监控与你的视频交付相关的 QoS 和 QoE 数据。
