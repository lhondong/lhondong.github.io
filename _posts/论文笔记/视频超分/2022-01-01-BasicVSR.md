---
title: "BasicVSR: The Search for Essential Components in Video Super-Resolution and Beyond"
subtitle: "BasicVSR"
layout: post
author: "L Hondong"
header-img: "img/post-bg-1.jpg"
mathjax: true
tags:
  - 视频超分
---

# BasicVSR

CVPR2021

BasicVSR: The Search for Essential Components in Video Super-Resolution and Beyond

Kelvin C.K. Chan, Xintao Wan, Chao Dong

S-Lab, Nanyang Technological University, CUHK – SenseTime Joint Lab, The Chinese University of Hong Kong

## 摘要

由于需要利用额外的时序信息，视频超分往往比图像超分包含更多的模块，所以就会有各式各样的复杂结构。

梳理总结了视频超分的四个基本模块：Propagation, Alignment, Aggregation, Upsampling（传播、对齐、融合、上采样），通过对这些组件的重用和部分修改，构建了一个 BasicVSR 模型。

通过复用现有方案的模块并添加微小改动，实现了一种简单方案：BasicVSR，它在推理速度、复原质量方都有极大的提升。

对 BasicVSR 进一步进行扩展，添加了一个信息再填充机制和一个耦合传播方案，实现了更好性能的 IconVSR，达到了 SOTA。

## 一、简介

### 1.1 Motivation

只需要对现有方案小幅度的重新设计，就可以实现视频超分的 baseline。

BasicVSR：在四个组件中，传播和对齐组件对性能和效率有较大的影响。实验表明传播使用双向传播可以最大化信息聚集，对齐使用光流方法进行相邻帧对齐效果好。剩下的两个，特征（采用 feature concatenation）和上采样（采用 pixel-shuffle）只需要使用常用设计简化组件，就可以实现很好的性能和效率。

IconVSR：在 BasicVSR 的基础上作两种新颖的扩展：

1. 信息补充 information-refill，使用额外的模块从稀疏选择帧（比如关键帧）中提取特征，然后插入到主网络用于改善特征。
2. 耦合传播，促进了前向与反向传播分支中的信息交换。

IconVSR 的信息补充机制来自 interval-based 基于间隔的处理方法，将视频帧划分为以关键帧和非关键帧为特征的独立间隔，然后用不同的 pipeline 处理关键帧和非关键帧。例如 FAST 使用 SRCNN 来超分关键帧，然后使用放大的关键帧和存储在压缩视频编解码器中的运动矢量来恢复非关键帧。IconVSR 继承了关键帧的概念，但与独立处理间隔的现有方法不同，通过传播分支连接间隔，这样长期信息可以在相互关联的时间间隔内传播，从而进一步提高效率。

这两个模块不仅可以降低由于遮挡和图像边界造成的误差累积问题，同时可以获取更完整的时序信息以生成更高质量的特征，进而得到更好的重建结果。IconVSR 比 BasicVS 提高了 0.31dB。

## 二、相关工作

## 三、方法

### 3.1 BasicVSR

- Propagation：指信息的时域传播方式，比如局部信息，单向信息流动，双向信息流动；
- Alignment：指对齐的类型以及有无，空间的变换；
- Aggregation：指的是对齐的特征的集成方式；
- Upsampling：指的是上采样过程所采用的方案，基本都是 Pixel-Shuffle。

<div align=center><img src="/images/BasicVSR-2022-01-11-19-08-48.png" alt="BasicVSR-2022-01-11-19-08-48" style="zoom:50%;" /></div>

### Propagation

VSR 中最具影响力的模块，它特指信息的利用方式。现有的传播机制可以分为三大类：局部传播、单向传播和双向传播。

- 局部传播：滑动窗口方法在局部窗口中使用 LR 进行局部信息恢复，由于忽略了远处的帧，从而限制了恢复效果。
- 单向传播：第一帧除了自身之外不从视频序列接收信息，而最后一帧从整个序列接收信息。这种不平衡的方法使得靠前的帧的重建效果不佳。
- 双向传播：对比上述，BasicVSR 采用双向传播的方式。

#### Local Propagation

滑动窗口的方法（比如 RBPN，TGA，EDVR）采用局部窗口内的多帧 LR 图像作为输入并进行中间帧的重建。这种设计方式限制信息在局部范围内，忽略远处视频帧不可避免会影响模型的性能。

将视频切分为几段，测试每一段的 PSNR，与不切分的 PSNR 比较。下图给出了不同信息范围下的模型性能对比，可以看到：

1. 切分的视频段数越少，时间感受野越大，PSNR 差异越小。全局信息的利用具有更佳性能
2. 片段的两端性能差异非常大，说明了长序列累积信息（即全局信息）的重要性。

<div align=center><img src="/images/BasicVSR-2022-01-11-19-09-43.png" alt="BasicVSR-2022-01-11-19-09-43" style="zoom:50%;" /></div>

证实采用全局传播的重要性。

#### Unidirectional Propagation

上述问题可以通过采用单向传播来解决，信息从第一帧顺序传播到最后一帧。但是这种方式会导致不同帧接受的信息不平衡，比如第一帧只会从自身接受信息，而最后一帧则可以接受整个序列的信息。

下图给出了单向传播与双向传播的性能差异对比。可以看到：

1. 在早期，单向传播方案的 PSNR 指标严重低于双向传播方案；
2. 整体来看，单向传播方案的指标要比双向传播的方案低 0.5dB。

<div align=center><img src="/images/BasicVSR-2022-01-11-19-13-20.png" alt="BasicVSR-2022-01-11-19-13-20" style="zoom:50%;" /></div>

#### Bidirectional Propagation

上述两种信息传播方案的弊端可以通过双向传播方案解决，特征会同时独立地正向和反向传播。BasicVSR 采用了经典的双向传播机制，给定输入图像及其近邻帧，相应的特征传播分别描述为和，定义如下：

$$
\begin{aligned}
h^b_i &=F_b(x_i,x_{i+1},h^b_{i+1})\\
h^f_i &=F_f(x_i,x_{i−1},h^f_{i−1})
\end{aligned}
$$

$F_b,F_f$ 分别表示正向和反向传播分支。

### Alignment

空间对齐在 VSR 中起着非常重要的作用，它负责将高度相关的的图像/特征进行对齐并送入到后续的集成模块。主流的对齐可分为三大类：无对齐，图像对齐和特征对齐。

- 无对齐：在实验中去掉了 BasicVSR 中的空间对齐模块。在这种情况下，直接连接不对齐的特征进行恢复。感受野相对较小的卷积等局部操作在从相应位置聚集信息时效率低下，PSNR 下降了 1.19db。（RRN 没有采用对齐，并且是单向传播，PSNR 值只差了 0.27dB，此处数据需要验证）
- 图像对齐：图像对齐通过计算光流和在恢复之前扭曲图像来执行对齐。在 BasicVSR 上比较了图像扭曲和特征扭曲，由于光流估计的不精确性，扭曲后的图像不可避免地会出现模糊和不正确的问题。PSNR 下降了 0.17db。
- 特征对齐：对比上述，Basic 采用光流对特征进行扭曲配准，然后输入进多个残差块进行细化。

#### Without alignment

有的递归方案（比如 RLSP、BRCN、RSDN、RRN）通常不进行对齐，非对齐的特征直接进行集成，具有相对较小感受野的局部操作（如卷积）在聚合来自相应位置的信息时效率低下，导致性能不是最优的。

在实验中，不添加对齐会导致 1.19dB 的指标下降，结果表明，采用具有足够大的感受野以聚集来自遥远空间位置的信息的操作是非常重要的，也就是说**对齐是非常有必要**。

#### Image alignment

早期的 TOFlow 采用光流在图像层面进行对齐，已有研究表明：相比图像层面对齐，**特征层面的对齐可以取得显著的性能提升**。

在实验中，图像对齐方式会比特征对齐方式少 0.17dB。

#### Feature alignment

采用了类似 TOFlow 的光流方案，并进行特征对齐而不是图像对齐，对齐后的特征融入到后的残差模块中。这里采用的特征对齐可以描述如下：

$$
\begin{aligned}
s^{\{b,f\}}_i &= S(x_i, x_{i±1})\\ 
\overline h^{\{b,f\}}_i &= W(h^{\{b,f\}}_{i±1}, s^{\{b,f\}}_i)\\ 
h^{\{b,f\}}_i &= R_{\{b,f\} }(x_i,\overline h^{\{b,f\}}_i)
\end{aligned}
$$

$F_{\{b,f\}}= R_{\{b,f\}} ◦ W ◦ S$，$S$ 和 $W$ 分别表示光流估计和空间扭曲模块，$R_{\{b,f\}}$ 表示残差块的堆叠。

### Aggregation & Upsampling

BasicVSR 采用了非常基本的模块（残差模块以及 PixelShuffle）用于特征集成与上采样，假设中间特征表示，这里的特征集成与上采样模块描述如下：

$$y_i=U(h^f_i,h^b_i)$$

总而言之，BasicVSR 采用经典的双向循环神经网络。特征层面的光流对齐、Concatenate 进行特征集成，上采样模块 $U$ 包含卷积和 Pixel-shuffle。$S$、$W$、$R$ 分别为流估计模块、空间扭曲模块和残差块。

<div align=center><img src="/images/BasicVSR-2022-02-16-19-28-33.png" alt="BasicVSR-2022-02-16-19-28-33" style="zoom:50%;" /></div>

尽管 BasicVSR 是一种简洁的方法，但在恢复质量和效率方面都很好，同时其通用性也很好，因为可以很容易地采用更多的组件来处理更具挑战性的场景。

### IconVSR

以 BasicVSR 作为骨干，引入了两个新的组件：信息再填充机制和耦合传播，以减少传播过程中的错误积累，促进信息聚合。

<div align=center><img src="/images/BasicVSR-2022-01-11-19-28-07.png" alt="BasicVSR-2022-01-11-19-28-07" style="zoom:50%;" /></div>

#### Information-Refill

遮挡区域和图像边界上的不正确对齐会导致误差累积问题，尤其是本文所采用的长期传播方案。为了减轻这种错误特征带来的不良影响，提出了信息补充机制。附加的特征提取器用于从输入帧（关键帧）及其各自的邻域的子集中提取深层特征。然后通过卷积将提取的特征与对齐的特征融合。该过程描述如下：

$$
\begin{aligned}
e_i &= E(x_{i−1}, x_i, x_{i+1})\\ 
\hat h_i^{\{b,f\}} &= \begin{cases} C(e_i,\overline h_i^{\{b,f\}}) &\text{if } i\in I_{key} \\ h_i^{\{b,f\}} &\text{otherwise}\end{cases}
\end{aligned}
$$

其中 $E$ 和 $C$ 分别表示特征提取器与卷积。融合后的特征将被融入到后续的残差模块中进一步细化：

$$
h^{\{b,f\}}_i = R_{\{b,f\} }(x_i,\hat h^{\{b,f\}}_i)
$$

值得注意的是，特征提取器和特征融合仅应用于稀疏选择的关键帧。因此，信息补充机制带来的计算负担是微不足道的。

虽然信息补充继承了关键帧的思想，但与现有的基于间隔的方法不同，基于间隔的方法将间隔分离以进行独立处理，而 IconVSR 中的间隔（由关键帧分隔）会连接起来以保持全局信息传播。

#### Coupled Propagation

在双向传播中，特征通常在两个相反的方向上独立传播，每个传播分支中的特征都是根据部分信息（来自先前的帧或将来的帧）来计算的。为了更好地利用序列中的信息，提出了耦合传播机制。在耦合传播模块中，传播模块是相互连接的，将向后传播的特征 $h^b_i$ 作为向前传播模块中的输入：

$$
\begin{aligned}
h^b_i&=F_b(x_i,x_{i+1},h^b_{i+1})\\
h^f_i&=F_f(x_i,x_{i−1},h^b_i,h^f_{i−1})\\
y_i&=U(h^f_i)
\end{aligned}
$$

通过耦合传播机制，前向传播分支可以获得来自过去和未来帧的信息，从而产生更高质量的特征和更好的输出。更重要的是，由于耦合传播只需要改变分支连接，因此可以在不引入计算开销的情况下获得性能增益。

## 四、实验

### Datasets

- 训练集：REDS 和 Vimeo90K；
- 验证集：REDSval4

- 测试集：UDM10、Vimeo90K-T。

四倍下采样，退化方式 Bicubic（BI）和 Blur Downsampling（BD）。

SpyNet 用于光流估计，EDVR-M 用于特征提取，Adam 优化器，学习率余弦退火，特征提取的学习率 $1×10^{−4}$，光流估计的学习率为 $2.5×10^{−5}$，其他部分的学习率为 $2×10^{−4}$。

训练迭代 300K 次，特征提取与光流的权值在 5000 次迭代时固定。

Batch=8，LR 的 patch 大小为 64×64，Charbonnier 损失（比传统的ℓ2 损失能更好地处理异常值）

### 量化评估

下表给出了所提方案与其他视频超分方案在不同退化方式、不同测试集上的指标、推理速度以及参数量的对比。

<div align=center><img src="/images/BasicVSR-2022-01-11-19-30-33.png" alt="BasicVSR-2022-01-11-19-30-33" style="zoom:50%;" /></div>

从上表可以看到：

- **BasicVSR 以全面优势超过了现有视频超分方案**，在 UDM10 数据集上，比第二名 RSDN 好的最多（0.61dB），且参数量相当、速度更快；
- **IconVSR 可以进一步提升 BasicVSR 的指标高达 0.31dB**。

## 五、消融实验

对 IconVSR 两个提出的组件的消融实验：

<div align=center><img src="/images/BasicVSR-2022-02-16-19-42-23.png" alt="BasicVSR-2022-02-16-19-42-23" style="zoom:50%;" /></div>

### Tradeoff in IconVSR

虽然 IconVSR 使用固定的关键帧间隔进行训练，但可以减少关键帧的数量以加快推理。图 10 中描绘了使用不同数量的关键帧的 PSNR，其中我们看到 PSNR 与关键帧的数量正相关，从而验证了信息补充机制的作用。

在没有关键帧的极端情况下，IconVSR 退化为一个循环网络，在 REDSval4 上 PSNR 仍有 30.38 dB，比 BasicVSR 高 0.21 dB。这证明了我们的耦合传播方案的有效性，可以在不引入额外计算开销的情况下使用。

<div align=center><img src="/images/BasicVSR-2022-01-11-19-31-56.png" alt="BasicVSR-2022-01-11-19-31-56" style="zoom:50%;" /></div>
