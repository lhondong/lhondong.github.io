---
title: "Practical Video Quality Enhancement Using Data-Centric Super Resolution"
subtitle: "dcSR"
layout: post
author: "L Hondong"
header-img: "img/post-bg-13.jpg"
mathjax: true
tags:
  - 视频超分
  - 视频传输
---

# dcSR

Practical Video Quality Enhancement Using Data-Centric Super Resolution

Stony Brook University

## 摘要

下一代沉浸式视频应用的发展，网络成为 deliver 的瓶颈。引入超分，使用客户端的算力，DNN 提升视频质量。然而现有的 SR 模型算力要求太高，很难部署。所以提出 dcSR，轻量级的、以数据为中心的 SR 方法。

在服务器端，dcSR 通过采用长期视频场景理解机制，以数据为中心，在每个视频的几个选定帧上构建轻量 SR 模型。

在客户端，dcSR 将轻量 SR 模型集成到常规视频解码器中，在不影响视频质量的前提下实时提高视频质量。

## 一、简介

### 1.1 Motivation

近年来，互联网视频在用户、应用程序和网络协议等多种方面都得到了快速发展，对网络容量的需求呈指数级增长。

尽管提高了 QoE，但是大部分工作都依赖于单一维度的资源——网络容量。这导致网络好的用户视频质量好，网络差的用户就会视频质量差。随着争夺共享网络资源的最终用户数量的增加，这个问题变得更加尖锐。

利用额外的客户端算力，使用超分方法，在网络容量差的客户端下载低质量视频，然后在播放之前通过 DNN 增强视频。

考虑到客户端设备（如 GPU/NPU）不断增长的算力，DNN 是改善最终用户体验的自然选择。

现存的挑战：1. 当前 SR 模型在计算和内存方面非常昂贵；2. generalization-specialization trade-off。第一个挑战主要因为需要训练庞大的 SR 模型以实现良好的质量增强。第二个挑战在标准数据集上训练 SR 模型，以在所有视频中应用模型，但是在看不见的模型上几乎没有改善质量；如果为每个视频定制 SR 模型的话，需要和视频一起下载模型。因此，现有的 SR 方法不能直接应用于今天计算受限的客户端设备上的实时点播视频流。

Data-Centric SR，能够在各种各样的客户端设备上实现实时视频增强。核心在于以数据为中心，SR 模型通过对视频数据的特殊理解进行训练，不同于现有的以模型为中心（优化模型以处理数据中的噪声）的方法，dcSR 的目标是提高训练的数据一致性。

为此，dcSR 自动分析视频中的长期时空冗余并在几个选定帧上应用 SR，为每个视频构建几个轻量级微观 SR 模型，有效地最小化客户端计算推理时间而不损害视频质量增强。

仅增强 I 帧就足够，P 帧和 B 帧依赖于 I 帧，会自动增强。持续时间较长的视频往往具有重复的 GOP 结构，这意味着视频中的场景有时会重复，I 帧相似，只是时间间隔较长，为一个 I 帧训练的模型可以用于其他类似的 I 帧。

在服务器端，dcSR 为每个视频构建了几个轻量级 micro SR 模型，每个模型对应于一组选定的 I 帧。使用特征提取和聚类机制对视觉相似的 I 帧进行分组，并针对每个 I 帧聚类训练每个 micro 模型。这样的设计优化了每段视频的模型数目和模型参数，在保证质量的前提下，有效地解决了推理和模型下载的难题。

在客户端，设计了一个视频解码器集成 pipeline，无缝地增强解码图像缓冲区中的 I 帧，并为属于同一聚类的未来 I 帧缓存模型。

在 FFMPEG 的基础上构建了 dcSR 原型，与最先进的方法相比，dcSR 可以在不同的设备上实时执行 SR（>30FPS），而不会影响相同带宽下的视频质量增强。对于相同的视频质量，dcSR 减少了 25%的带宽使用。

### 1.2 Contributions

1. 设计了一种实用的超分辨率实时视频质量增强方法；
2. 将 dcSR 集成到 FFMPEG 的 H.264 解码器实现中来构建 SR-FFMPEG；
3. 与最先进的 SR 方法进行比较，全面评估并展示了 dcSR 的好处。

## 二、相关工作

### 2.1 Client-side Video Quality Enhancement

当网络容量有限时，客户端别无选择，只能下载并播放质量不佳的视频。利用客户端计算能力来超分，增强视频。

### 2.2 Practical Challenges of Video SR

理想情况下，设计一个用于任何视频增强的通用 SR 模型，这样就不需要每次下载模型。然而，互联网视频太多更新太快，为所有视频设计能够提供足够质量增强的单一模型可能是不可行的。

因此，为每个视频构建专门的 SR 模型，代价是随视频一起下载相应的模型。视频特定的 SR 模型更有效，因为可以对提取的特定视频的像素之间的非线性关系进行过拟合，即使在质量相对较低的情况下也能很好地增强视频。

存在的问题：
1. 推理延迟高：SR 推理小于 15 FPS，播放器必须每秒至少显示 30 帧视频。
2. 模型下载的开销：模型尺寸随着分辨率的增加而显著增大，传输视频时也要完成模型的传输，导致网络带宽的浪费。同时用户不管看的某些部分也会下载模型。
3. 质量差异大：当对较长的视频进行训练时，SR 模型试图概括整个视频，很难均匀地保留每个帧的细节。在一个 12mins 的视频上，质量可能变化 5 dB。

<img src="https://cdn.jsdelivr.net/gh/lhondong/Assets/Images/dcSR-2022-01-12-12-58-48.png" alt="dcSR-2022-01-12-12-58-48" style="zoom:50%;" />

## 三、方法

dcSR 由两部分组成。在服务器端，dcSR 基于从视频编解码器及其内容获得的信息，每个视频构建一些 micro SR 模型。micro SR 模型的模型结构更简单，仅在少数视频帧上进行训练。

在客户端，dcSR 无缝地将 SR 增强帧的质量传播到其余帧。

### 3.1 Server-side dcSR

1. 视频分割和特征提取，
2. 视频片段聚类，
3. 训练 micro 模型

<img src="https://cdn.jsdelivr.net/gh/lhondong/Assets/Images/dcSR-2022-01-12-12-59-16.png" alt="dcSR-2022-01-12-12-59-16" style="zoom:50%;" />

#### 视频分割和特征提取
可变长度视频分割，在分割视频时考虑 I 帧的适当位置，仅需要更少的 I 帧，同时在不降低质量的情况下实现更低的比特率。估计每一帧与前一帧有多大的不同，如果差值高于预定义的阈值，将开始一个新 segment。

可变长度视频分割允许每个视频片段由其 I 帧表示，因为片段中的所有其他帧在视觉上与 I 帧相似。将 I 帧聚类成具有相似特征的组，为每个聚类构建 micro SR 模型。使用 VAE 从 I 帧中提取高级特征。

同时训练编码器和解码器，但只使用编码器来获得潜在的特征，然后将这些特征作为聚类算法的输入。

#### 视频片段聚类

𝐾-means 算法。一个问题是如何确定最优超参数𝐾，这会影响总体性能。由于 SR 模型大小和最小 SR 性能等潜在约束，仅依赖 silhouette 参数可能使得 dcSR 不是最优聚类。

部署时 𝐾 微模型的数量，而不是整个视频的一个大型模型，微模型的总体尺寸不应超过大型模型的尺寸。这样的约束限制了𝐾。

#### 训练 micro 模型

构建对应于每个聚类的微观 SR 模型，提取每个聚类中所有片段的 I 帧。

### 3.2 Client-side dcSR

1. 解码和增强 I 帧后，其余帧（P 和 B）根据增强质量的 I 帧重建；
2. 希望通过缓存模型来避免冗余模型下载，以便将来 I 帧质量的增强。

#### 集成到视频解码器

将 dcSR 添加为现有视频解码器进程的一个附加处理层。一旦客户端接收到视频片段和相应的 micro-SR 模型，客户端中的视频解码器解码视频片段的 I 帧，并将其临时存储在解码图片缓冲器（DPB）中，以用于解码后续 P 帧和 B 帧。

这里需要暂停后续 P 帧和 B 帧的剩余解码过程，以将 SR 应用于 DPB 中的 I 帧。由于 DPB 中的 I 帧默认为 YUV 格式，dcSR 将帧格式转换为 RGB 格式。

在颜色转换之后，dcSR 使用 micro SR 模型增强 DPB 中 I 帧的质量。dcSR 将增强的 I 帧转换回剩余解码过程所需的 YUV 格式，参考增强质量的 I 帧恢复 P 帧和 B 帧。

#### Micro SR Model Caching

dcSR 客户端为整个视频下载多个 micro SR 模型，而不是单个大型模型。在部署多个微 SR 模型时，通过视频片段之间的长期时间相关性来间歇使用每个微模型，以避免冗余模型下载。例如，视频开头的一个片段在几分钟后可以属于另一个片段的同一聚类，并且两个片段可以使用为相应聚类训练的相同模型。为了利用这一点，缓存为早期片段下载的模型，以避免下载重复的模型。

## 四、实验

客户端 SR-FFMPEG，NAS 和 NEMO，NAS 在每个视频帧上应用 SR，而，NEMO 在几个选定的帧上应用 SR 以加快推断速度，这里 NEMO 被简化为仅将 SR 应用于 I 帧，以便与 dcSR 进行公平比较。

部署在 6 个视频上的三种不同配置评估 dcSR：dcSR-1、dcSR-2 和 dcSR-3，将模型复杂度从 1 增加到 3。dcSR-1、dcSR-2 和 dcSR-3 由 4、12 和 16 个残差块组成，每个残差块都有 16 个卷积滤波器。

### 实验结果

为了评估推理速度，我们使用了三类设备（移动设备、笔记本电脑和台式机）。

<img src="https://cdn.jsdelivr.net/gh/lhondong/Assets/Images/dcSR-2022-01-12-12-59-42.png" alt="dcSR-2022-01-12-12-59-42" style="zoom:50%;" />

### 4.4 消融实验

## 五、总结

## 六、思考