---
title: "COMISR: Compression-Informed Video Super-Resolution"
subtitle: "压缩视频超分 COMISR"
layout: post
author: "L Hondong"
header-img: "img/post-bg-3.jpg"
mathjax: true
tags:
  - 视频超分
  - 视频压缩
---

# 压缩视频超分 COMISR

COMISR: Compression-Informed Video Super-Resolution

Google

## 摘要

大多数视频超分辨率方法侧重于从低分辨率视频恢复高分辨率视频帧，而不考虑压缩视频。但是，网络或移动设备上的大多数视频都是压缩的，当带宽有限时，压缩可能会很严重。

提出了一种新的压缩感知视频超分辨率模型来恢复高分辨率内容，而不引入压缩引起的伪影。该模型由三个视频超分辨率模块组成：bi-directional recurrent warping 双向循环扭曲、detail-preserving flow estimation 保持细节的流估计和拉普拉斯增强。

这三个模块都用于处理压缩特性，例如输入帧中帧内的位置和输出帧中的平滑度。

为了进行全面的性能评估，我们在具有各种压缩率的标准数据集上进行了各种的实验，涵盖了许多真实的视频用例。COMISR 不仅可以从广泛使用的标准数据集中恢复未压缩帧上的高分辨率内容，而且还可以在基于众多量化指标的超分辨率压缩视频中实现 SoTA 的性能。通过模拟 YouTube 上的流媒体评估，以证明其有效性和鲁棒性。

## 一、简介

SISR: use learned image priors to recover high-resolution details of the given image,

VSR: use both image priors and inter-frame information to generate temporally smooth high-resolution results

先前工作中使用的未压缩视频实际上是低压缩率的高质量图像序列。因此这类方法在高压缩率的视频和图像上时，可能会造成伪影。

H.264 编码中广泛使用的压缩率（恒定速率因子（CRF））为 23，这是视觉质量和文件大小之间的折衷。当输入视频被压缩时，最先进的 VSR 算法效果不好。

一个可行的解决方案是在应用最先进的 VSR 模型之前，首先对图像进行去噪并去除图像中的压缩伪影。然而，在第 4.3 节中的实验表明，这种方法不会改善 SR 结果，反而会对视觉质量产生负面影响。通过预处理，第一步中的去噪模型可能与 VSR 训练过程中隐式使用的退化核有很大不同。经过去噪处理后，VSR 模型需要有效地处理更具挑战性的图像。

另一个可行的解决方案是在压缩图像上训练现有的最先进的 VSR 模型。这将强制 VSR 模型考虑训练过程中的压缩伪影。然而，在第 4.5 节中描述的实验表明，在模型训练中简单地使用压缩帧只能带来适度的改进。事实上，如果不对网络模块的设计进行具体更改，此类训练数据甚至可能对整体性能产生负面影响。

为了解决上述问题，提出了一种压缩感知 compression-informed （即 compression-aware) 超分辨率模型，该模型可以在具有不同压缩级别的真实视频上运行良好。设计了三个模块来有效地恢复由于视频压缩而丢失的信息。

- 首先，提出了一个双向循环模块，以减少压缩视频帧中帧内随机位置的累积扭曲误差 [46]。
- 其次，引入细节感知流估计模块，从压缩的 LR 帧中恢复 HR 流。
- 最后，采用拉普拉斯增强模块将高频信息添加到通过视频编码去除的扭曲 HR 帧中。

将此模型称为压缩信息视频超分辨率（COMISR）。

通过消融研究证明了这些模块的有效性，在几个 VSR 基准数据集上进行了广泛的实验，包括 Vid4[32] 和 REDS4[41]，使用不同 CRF 值压缩的视频。实验表明，COMISR 模型在压缩视频（如 CRF23）上获得了显著的性能增益，同时在未压缩视频上效果也不错。

<div align=center><img src="../assets/COMISR-2022-01-12-12-48-58.png" alt="COMISR-2022-01-12-12-48-58" style="zoom:50%;" /></div>

此外，还提供了基于最先进的 VSR 模型和现成视频去噪器的不同组合的评估结果。最后在使用专有编码器压缩的 YouTube 视频上验证了 COMISR 模型的健壮性。

### Contributions

- 提出一个用于超分辨率真实压缩视频的压缩感知的模型，实现了最先进的性能；
- 结合三个视频超分中新颖的模块，以有效提高压缩帧上视频超分辨率的关键组件；
- 在压缩基准数据集上对最先进的 VSR 模型进行了广泛的实验。我们还提出了一个新的设定，以评估针对 YouTube 转码视频的 VSR 模型，这是一个现有的评估方法不考虑的现实世界的应用场景。

## 二、相关工作

### 2.1 SISR

GAN：SRGAN [28], EnhanceNet [44], ESRGAN [55], SPSR [39] and SRFlow [37]

## 三、方法

COMISR 模型基于递归公式设计，与现有的 SoTA VSR 模型类似，利用前一帧的视觉信息来超分当前帧。递归模型仅需要很少的内存，所以适用于视频中的大量推理任务。

<div align=center><img src="../assets/COMISR-2022-01-12-12-49-55.png" alt="COMISR-2022-01-12-12-49-55" style="zoom:50%;" /></div>

给定 LR GT 帧，使用前向和后向递归模块，生成 HR 帧，并计算两个方向上 HR GT 帧的内容损失。在递归模块中，在 LR 和 HR 同时预测光流、生成扭曲帧，使用 LR 和 HR GT 帧端到端训练网络。

### 3.1 Bi-directional Recurrent Module

常见的视频压缩方法是采用不同的算法对视频流中不同位置的帧进行压缩和编码，分为帧内预测和帧间预测。

I 帧压缩率低，但是伪影更少；由于 I 帧位置未知，为了有效减少视频超分过程中，I 帧未知位置导致的累积误差，提出一种双向递归网络来增强 LR 扭曲输入和 HR 预测帧的前向和后向一致性。

双向递归网络由前向和后向的对称模块组成。

前向过程中，同时估计 LR 光流 $F^{LR}_{t-1\rightarrow t}$ 和 HR 光流 $F^{HR}_{t-1\rightarrow t}$，然后 LR 和 HR 流采取不同的操作。

LR 流：

$$
\tilde{I}_{t}^{LR}=Warp\left(I_{t-1}^{LR}, F_{t-1 \rightarrow t}^{LR} \right)
$$

HR 流：

$$
\tilde{I}_{t}^{HR,Warp}=Warp\left(\hat{I}_{t-1}^{HR}, F_{t-1\rightarrow t}^{H R} \right)
$$

$$
\tilde{I}_{t}^{HR}=Laplacian\left(\tilde{I}_{t}^{HR,Warp}\right)+\tilde{I}_{t}^{HR,Warp} 
$$

### 3.2 Detail-aware Flow Estimation

在递归模块中，显式地估计相邻帧之间的 LR 和 HR 流，并在前向和后向方向传递。

首先连接相邻的 LR 帧 $I^{LR}_{t-1}$ 和 $I^{LR}_{t}$，然后利用 LR 光流估计网络估计 LR 光流 $F^{LR}_{t-1\rightarrow t}$。不直接对 $F^{LR}_{t-1\rightarrow t}$ 上采样，而是在 bilinear 上采样的前面增加了几个额外的反卷积层。因此在端到端的训练过程中可以更好的预测 HR 流中的高频细节。

### 3.3 Laplacian Enhancement Module

拉普拉斯残差，在从视频帧中找到细节时特别有用，在视频压缩过程中可以平滑这些细节。

扭曲的预测 HR 帧保留了从先前帧中学习到的详细纹理信息，这种细节很容易在放大网络中丢失。因此将拉普拉斯残差添加到预测的 HR 帧以增强细节。

## 四、实验

### 4.1 数据集

REDS 和 Vimeo 作为训练集。

这两个数据集之间的主要区别是 REDS 数据集包含手持设备捕获运动更剧烈的图像。

### 4.2 压缩方法

使用 H.264 最常见的设置在不同的压缩率（即不同的 CRF 值）下编码视频。CRF 推荐值在 18 和 28 之间，默认值为 23。实验中使用 CRF 为 15、25 和 35 来评估不同压缩率的视频超分。为了公平比较，在评估其他方法时，使用相同的退化方法在压缩前生成 LR 序列。最后这些压缩的 LR 序列被送入 VSR 模型进行推理。

### Youtube 实验

首先从原始帧生成未压缩的视频，然后将它们上传到 YouTube。这些视频以不同的分辨率进行编码和压缩以供下载。上传的视频是 1280×720，youtube 将其压缩为 480p, 360p, 240p, 和 144p。下载其中的 360p，比较三种算法 MuCAN、RSDN 和 TecoGan。

<div align=center><img src="../assets/COMISR-2022-01-12-12-57-06.png" alt="COMISR-2022-01-12-12-57-06" style="zoom:50%;" /></div>

<div align=center><img src="../assets/COMISR-2022-01-12-12-57-18.png" alt="COMISR-2022-01-12-12-57-18" style="zoom:50%;" /></div>

<div align=center><img src="../assets/COMISR-2022-01-12-12-57-29.png" alt="COMISR-2022-01-12-12-57-29" style="zoom:50%;" /></div>

<div align=center><img src="../assets/COMISR-2022-01-12-12-57-46.png" alt="COMISR-2022-01-12-12-57-46" style="zoom:50%;" /></div>

## 五、总结
